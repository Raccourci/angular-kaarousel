"use strict";angular.module("angular-kaarousel",["ngTouch"]).directive("kaarousel",["KaarouselFactory","$timeout","$interval","$window",function(e,t,n,i){return{restrict:"EA",scope:{displayed:"=?",perSlide:"=?",autoplay:"=?",pauseOnHover:"=?",centerActive:"=?",timeInterval:"=?",updateRate:"=?",stopAfterAction:"=?",hideNav:"=?",hidePager:"=?",navOnHover:"=?",pagerOnHover:"=?",isSwipable:"=?",sync:"=?",data:"=?",animation:"=?",loop:"=?",options:"=?",onSlide:"&?",minWidth:"=?",expand:"=?"},templateUrl:"src/angular-kaarousel.html",transclude:!0,controller:["$scope","$element","$attrs",function(t,n,i){var s=this;s.update=function(e){s.setSettings(),s.getFactory().update(e)},s.move=function(e){s.factory.move(e,!0),s.getSettings().sync!==!1&&(t.sync=s.getFactory().get("activeIndex")),t.$broadcast("updateIndex",s.getFactory().get("activeIndex"))},s.setSettings=function(){return s.settings=s.getFactory().makeConf(i,t),s.settings},s.getSettings=function(){return s.settings||s.setSettings(),s.settings},s.getParentScope=function(){return t},s.getFactory=function(){return s.factory||(s.factory=new e),s.factory},s.register=function(e,t){s.getFactory().set(e,t)},s.reachedLastItem=function(){var e=s.getFactory();e.get("isReady")&&e.update(),e.set("isReady",!0),t.shouldAnim=!0,s.settings.autoplay&&!s.playing&&s.getFactory().setInterval(),s.getFactory().set("elements",s.elements),s.getFactory().set("slides",s.slides),s.getFactory().set("sizes",s.sizes)},s.addSlide=function(e,t){var n=angular.element(e);s.elements=s.elements||[],s.slides=s.slides||[],s.sizes=s.sizes||[],s.elements.push(e),t&&s.slides.push(t),s.sizes.push({width:n.outerWidth(),height:n.outerHeight()})}}],link:function(e,n,s,a){var r,o,l=a.getFactory(),u=angular.element(i),d="[autoplay,timeInterval,displayed,perSlide,centerActive,stopAfterAction,pauseOnHover,minWidth,hideNav,hidePager,navOnHover,pagerOnHover]";angular.element(n).addClass("kaarousel"),a.getSettings(),e.move=a.move,e.factory=l,e.$watchCollection(d,function(e,n){t.cancel(r),r=t(function(){for(var t=!1,i=0;2>i;i++)if(e[i]!==n[i]){t=!0;break}a.update(t)},a.getSettings().updateRate)}),e.$watch(function(){return u.width()},function(){t.cancel(o),o=t(function(){a.update(!0)},a.getSettings().updateRate||500)}),e.$watch("sync",function(t,n){t=parseInt(t,10),n=parseInt(n,10),!isNaN(t)&&isNaN(n)&&l.setInterval(!0),isNaN(t)||(e.shouldAnim||(e.shouldAnim=!0),l.move(t,!1)),isNaN(t)&&!isNaN(n)&&a.update(!0)}),e.$on("$destroy",function(){l.setInterval(!0)})}}}]),angular.module("angular-kaarousel").service("KaarouselFactory",["$interval","$timeout",function(e,t){var n=function(e){return parseInt(e,10)},i=function(){var e=this;e.settings={},e.activeIndex=0,e.interval=0,e.sliderDomElement=null,e.slides=[],e.elements=[],e.sizes=[],e.isReady=!1,e.hasStarted=!1,e.userAction=null,e.pausedByUser=null};return i.prototype.defaultSettings={displayed:3,perSlide:1,autoplay:!0,pauseOnHover:!0,centerActive:!1,timeInterval:3e3,transitionDuration:500,stopAfterAction:!1,hideNav:!1,hidePager:!1,navOnHover:!1,pagerOnHover:!1,isSwipable:!0,sync:!1,animation:"slide",loop:!1,onSlide:null,minWidth:null,expand:!0,updateRate:100},i.prototype.set=function(e,t){this[e]=t},i.prototype.get=function(e){return void 0!==this[e]?this[e]:null},i.prototype.makeConf=function(e,t){for(var n=["displayed","perSlide","autoplay","pauseOnHover","centerActive","timeInterval","stopAfterAction","hideNav","hidePager","navOnHover","pagerOnHover","isSwipable","sync","animation","loop","minWidth","expand"],i={},s=n.length-1;s>=0;s--)n[s]in e&&void 0!==t[n[s]]&&(i[n[s]]=t[n[s]]);return t.options&&(i=angular.extend(t.options,i)),i=angular.extend(angular.copy(this.defaultSettings),i),i.displayed=this.computeDisplayed(i),i.perSlide=this.computePerSlides(i),this.settings=i,this.shouldHideNav=this.settings.hideNav,this.shouldHidePager=this.settings.hidePager,i},i.prototype.computeDisplayed=function(e){var t,i=n(e.minWidth||0),s=Math.abs(Math.ceil(e.displayed));return i>0&&this.sliderDomElement&&(t=Math.floor(this.sliderDomElement.width()/i)||1),(!t||t>s)&&(t=s),this.elements.length>t&&t>s?s:t===s&&this.elements.length<t&&e.expand?this.elements.length:t},i.prototype.computePerSlides=function(e){var t=Math.abs(Math.ceil(e.perSlide)),n=e.displayed;return("slide"!==e.animation||t>n)&&(t=n),t},i.prototype.computeIndex=function(e){var t=this;return e>=t.elements.length?0:e<=-t.settings.perSlide?t.elements.length-1:0>e?0:e},i.prototype.move=function(e,i,s,a){var r=this;switch(r.hasStarted=!0,i&&this.settings.stopAfterAction&&(this.userAction=!0),this.setInterval(this.shouldStop()),e){case"next":r.activeIndex=r.computeIndex(r.activeIndex+r.settings.perSlide,a);break;case"prev":r.activeIndex=r.computeIndex(r.activeIndex-r.settings.perSlide,a);break;default:r.activeIndex=n(e)}this.sliderMargin=-r.getMargin(),s||"function"!=typeof r.settings.onSlide||t(function(){r.settings.onSlide()},r.settings.transitionDuration)},i.prototype.getStyles=function(){this.updateSizes();var e={};return null!==this.activeIndex&&("slide"===this.settings.animation?e={"margin-left":this.sliderMargin+"px"}:this.isReady&&(e={height:this.sizes[this.activeIndex].height})),e},i.prototype.setInterval=function(t){var n=this;e.cancel(n.interval),n.playing=!1,t||n.settings.sync||0===n.settings.sync||(n.interval=e(function(){n.playing=!0,n.move("next")},n.settings.timeInterval))},i.prototype.shouldStop=function(){return this.settings.autoplay?this.userAction&&this.settings.stopAfterAction||this.pausedByUser?!0:!1:!0},i.prototype.updateSizes=function(){for(var e=0;e<this.elements.length;e++){var t=angular.element(this.elements[e]);this.sizes[e]={width:t.outerWidth(),height:t.outerHeight()}}},i.prototype.update=function(e){var n=this;e&&this.setInterval(this.shouldStop()),this.bindEvents(),this.hasStarted&&t(function(){n.move(n.activeIndex,!1,!0)},100)},i.prototype.getMargin=function(){for(var e=0,t=0;t<this.elements.length;t++)t<this.loopUntil(this.activeIndex)&&t<this.elements.length-this.settings.displayed&&(e+=this.sizes[t].width);return e},i.prototype.loopUntil=function(e){return this.isCentered=!1,this.settings.centerActive&&1&this.settings.displayed&&(e-=Math.floor(this.settings.displayed/2),this.isCentered=!0),e},i.prototype.shift=function(e){this.sliderMargin=-(this.getMargin()+e)},i.prototype.removeSlide=function(e){this.elements.splice(this.elements.indexOf(e),1),this.update()},i.prototype.pause=function(){this.pausedByUser=!0,this.setInterval(!0)},i.prototype.resume=function(){this.pausedByUser=!1,this.setInterval(this.shouldStop())},i.prototype.mouseEnterCallback=function(){this.settings.pauseOnHover&&this.pause(),this.settings.navOnHover&&(this.shouldHideNav=!1),this.settings.pagerOnHover&&(this.shouldHidePager=!1)},i.prototype.mouseLeaveCallback=function(){this.wrapperDomElement.trigger("touchend"),!this.settings.stopAfterHover&&this.settings.pauseOnHover&&this.resume(),this.settings.navOnHover&&this.settings.hideNav&&(this.shouldHideNav=!0),this.settings.pagerOnHover&&this.settings.hidePager&&(this.shouldHidePager=!0)},i.prototype.bindEvents=function(e){var t=this,n=this.settings.pauseOnHover||this.settings.pagerOnHover||this.settings.navOnHover;(e||!n)&&(this.wrapperDomElement.unbind(),this.binded=!1),e||!n||this.binded||(this.binded=!0,this.wrapperDomElement.bind({mouseenter:function(){t.mouseEnterCallback()},mouseleave:function(){t.mouseLeaveCallback()}}))},i}]),angular.module("angular-kaarousel").directive("kaarouselSlide",function(){return{restrict:"EA",require:"^kaarousel",link:function(e,t,n,i){var s,a=i.getFactory(),r=e.$index;angular.element(t).addClass("kaarousel-slide"),n.ngRepeat&&(s=n.ngRepeat.split(" ")[0]),i.addSlide(t,s?e[s]:null),e.$last&&i.reachedLastItem(),e.isActive=function(){return a.get("activeIndex")===r},e.itemStyles=function(){var t=i.getSettings(),n=r%t.displayed,s=100/t.displayed,a={width:s+"%"};return"shuffle"===t.animation&&(a.left=Math.abs(n)*s+(e.isVisible()?0:100)+"%"),"fade"===t.animation&&(a.left=n*s+"%"),a},e.isVisible=function(){var e=a.get("activeIndex"),t=a.get("elements").length,n=i.getSettings().displayed;return i.getSettings().centerActive&&a.get("isCentered")?r>=e-Math.floor(n/2)&&r<=e+Math.floor(n/2)||n>e+1&&n>r||e>t-n-1&&r>t-n-1:r>=e&&e+n>r||r>t-n-1&&e>t-n-1},e.$on("$destroy",function(){a.removeSlide(t)})}}}),angular.module("angular-kaarousel").directive("kaarouselNav",function(){return{require:"^kaarousel",restrict:"EA",link:function(e,t,n,i){var s=i.getFactory();e.shouldHideNav=s.get("shouldHideNav");var a=function(){return s.get("shouldHideNav")||s.get("elements").length<=i.getSettings().displayed};e.$watch(function(){return i.getSettings()},function(){e.shouldHideNav=a()}),e.$watch(function(){return s.get("shouldHideNav")},function(){e.shouldHideNav=a()})}}}).directive("kaarouselPager",function(){return{restrict:"EA",require:"^kaarousel",link:function(e,t,n,i){var s=i.getFactory();e.shouldHidePager=s.get("shouldHidePager"),e.$watch(function(){return s.get("shouldHidePager")},function(t){e.shouldHidePager=t})}}}),angular.module("angular-kaarousel").directive("kaarouselWrapper",["$swipe","$timeout",function(e,t){return{restrict:"EA",require:"^kaarousel",link:function(n,i,s,a){var r,o,l=120,u=200,d=a.getFactory(),c=function(){var e=a.getSettings();return e.isSwipable&&a.getFactory().elements.length>e.displayed},g=function(){return r&&o&&Math.abs(r.x-o.x)>l},h=function(){return Math.floor(Math.abs(r.x-o.x)/u)+1};a.register("wrapperDomElement",i),d.bindEvents(),n.addSwipeOffset=function(){var e=r.x-o.x;d.shift(e)},n.resetSwipe=function(){n.shouldAnim=!0,n.dragging=!1,d.move(d.get("activeIndex"),!0,!0)},n.swipeHandler=e.bind(i,{start:function(e){c()&&t(function(){r=e,o=null})},move:function(e){c()&&t(function(){o=e,n.shouldAnim=!1,n.dragging=!0,n.addSwipeOffset()})},end:function(){c()&&o&&t(function(){var e=r.x-o.x;g()?e>0?d.get("activeIndex")<d.get("elements").length-1?d.move("next",!0,!1,h()):n.resetSwipe():d.get("activeIndex")>0?d.move("prev",!0,!1,h()):n.resetSwipe():n.resetSwipe(),n.shouldAnim=!0,n.dragging=!1})},cancel:function(){c()&&t(function(){n.resetSwipe()})}})}}}]).directive("kaarouselSlider",["$compile",function(e){return{restrict:"EA",require:"^kaarousel",link:function(t,n,i,s){var a='<kaarousel-dummy class="dummy" ng-style="getStyles()"></kaarousel-dummy>',r=angular.element(n);s.register("sliderDomElement",n),r.addClass(s.getSettings().animation+"-animation"),t.getStyles=function(){return s.getFactory().getStyles()},e(a)(t,function(e){r.prepend(e)})}}}]),function(e){try{e=angular.module("angular-kaarousel")}catch(t){e=angular.module("angular-kaarousel",[])}e.run(["$templateCache",function(e){e.put("src/angular-kaarousel.html",'<kaarousel-container class="kaarousel-actions-wrapper"><kaarousel-wrapper class="kaarousel-wrapper" ng-class="{anim: shouldAnim, dragging: dragging}"><kaarousel-slider ng-transclude="" class="kaarousel-slider"></kaarousel-slider></kaarousel-wrapper><kaarousel-nav class="kaarousel-nav" ng-class="{\'is-hidden\': shouldHideNav}"><kaarousel-prev ng-click="move(\'prev\')" ng-class="{\'is-hidden\': hidePrev}" class="kaarousel-prev">PREV</kaarousel-prev><kaarousel-next ng-click="move(\'next\')" ng-class="{\'is-hidden\': hideNext}" class="kaarousel-next">NEXT</kaarousel-next></kaarousel-nav><kaarousel-pager class="kaarousel-pager" ng-class="{\'is-hidden\': shouldHidePager}"><ul><li ng-repeat="i in factory.elements track by $index" ng-click="move($index)" ng-class="{selected: $index === factory.activeIndex}">{{$index}}</li></ul></kaarousel-pager></kaarousel-container>')}])}();