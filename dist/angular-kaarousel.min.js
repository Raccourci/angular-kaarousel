"use strict";angular.module("angular-kaarousel",["ngTouch"]).directive("kaarousel",["KaarouselFactory","$timeout","$interval","$window",function(e,t,i,n){return{restrict:"EA",scope:{displayed:"=?",perSlide:"=?",autoplay:"=?",pauseOnHover:"=?",centerActive:"=?",timeInterval:"=?",transitionDuration:"=?",updateRate:"=?",stopAfterAction:"=?",hideNav:"=?",hidePager:"=?",navOnHover:"=?",pagerOnHover:"=?",isSwipable:"=?",sync:"=?",data:"=?",animation:"=?",loop:"=?",options:"=?",afterSlide:"@?",beforeSlide:"@?",minWidth:"=?",expand:"=?"},templateUrl:"src/angular-kaarousel.html",transclude:!0,controller:["$scope","$element","$attrs",function(t,i,n){var s=this;s.update=function(e){s.setSettings(),s.getFactory().update(e)},s.move=function(e){s.factory.move(e,!0),s.getSettings().sync!==!1&&(t.sync=s.getFactory().get("activeIndex")),t.$broadcast("updateIndex",s.getFactory().get("activeIndex"))},s.setSettings=function(){return s.settings=s.getFactory().makeConf(n,t),s.settings},s.getSettings=function(){return s.settings||s.setSettings(),s.settings},s.getParentScope=function(){return t},s.getFactory=function(){return s.factory||(s.factory=new e,s.factory.set("scope",t)),s.factory},s.register=function(e,t){s.getFactory().set(e,t)},s.reachedLastItem=function(){var e=s.getFactory();e.get("isReady")&&e.update(),e.set("isReady",!0),t.shouldAnim=!0,s.settings.autoplay&&!s.playing&&s.getFactory().setInterval(),s.getFactory().set("elements",s.elements),s.getFactory().set("slides",s.slides),s.getFactory().set("sizes",s.sizes)},s.addSlide=function(e,t){var i=angular.element(e);s.elements=s.elements||[],s.slides=s.slides||[],s.sizes=s.sizes||[],s.elements.push(e),t&&s.slides.push(t),s.sizes.push({width:i.outerWidth(),height:i.outerHeight()})}}],link:function(e,i,s,a){var r,o,l=!1,u=a.getFactory(),d=angular.element(n),c="[autoplay,timeInterval,loop,displayed,perSlide,centerActive,stopAfterAction,pauseOnHover,minWidth,hideNav,hidePager,navOnHover,pagerOnHover,transitionDuration]";angular.element(i).addClass("kaarousel"),a.getSettings(),e.move=a.move,e.factory=u,e.$watchCollection(c,function(e,i){t.cancel(r),r=t(function(){for(var t=!1,n=0;3>n;n++)if(e[n]!==i[n]){t=!0;break}a.update(t)},a.getSettings().updateRate)}),e.$watch(function(){return d.width()},function(){t.cancel(o),o=t(function(){a.update(!0)},a.getSettings().updateRate||500)}),e.$watch("sync",function(t,i){t=parseInt(t,10),i=parseInt(i,10),!isNaN(t)&&isNaN(i)&&(l=!0,u.setInterval(!0)),isNaN(t)||(e.shouldAnim||(e.shouldAnim=!0),u.move(t,!1)),!isNaN(t)||isNaN(i)||l||(a.update(!0),l=!1)}),e.$on("$destroy",function(){u.setInterval(!0)})}}}]),angular.module("angular-kaarousel").service("KaarouselFactory",["$interval","$timeout",function(e,t){var i=function(e){return parseInt(e,10)},n=function(){var e=this;e.settings={},e.activeIndex=0,e.interval=0,e.sliderDomElement=null,e.slides=[],e.elements=[],e.sizes=[],e.isReady=!1,e.hasStarted=!1,e.userAction=null,e.pausedByUser=null};return n.prototype.defaultSettings={displayed:3,perSlide:1,autoplay:!0,pauseOnHover:!0,centerActive:!1,timeInterval:3e3,transitionDuration:500,stopAfterAction:!1,hideNav:!1,hidePager:!1,navOnHover:!1,pagerOnHover:!1,isSwipable:!0,sync:!1,animation:"slide",loop:!0,afterSlide:null,beforeSlide:null,minWidth:null,expand:!0,updateRate:100},n.prototype.set=function(e,t){this[e]=t},n.prototype.get=function(e){return void 0!==this[e]?this[e]:null},n.prototype.makeConf=function(e,t){for(var i=["displayed","perSlide","autoplay","pauseOnHover","centerActive","timeInterval","transitionDuration","stopAfterAction","hideNav","hidePager","navOnHover","pagerOnHover","isSwipable","sync","animation","loop","minWidth","afterSlide","beforeSlide","expand"],n={},s=i.length-1;s>=0;s--)i[s]in e&&void 0!==t[i[s]]&&(n[i[s]]=t[i[s]]);return t.options&&(n=angular.extend(t.options,n)),n=angular.extend(angular.copy(this.defaultSettings),n),n.displayed=this.computeDisplayed(n),n.perSlide=this.computePerSlides(n),this.settings=n,this.shouldHideNav=this.settings.hideNav,this.shouldHidePager=this.settings.hidePager,n},n.prototype.computeDisplayed=function(e){var t,n=i(e.minWidth||0),s=Math.abs(Math.ceil(e.displayed));return n>0&&this.sliderDomElement&&(t=Math.floor(this.sliderDomElement.width()/n)||1),(!t||t>s)&&(t=s),this.elements.length>t&&t>s?s:t===s&&this.elements.length<t&&e.expand?this.elements.length:t},n.prototype.computePerSlides=function(e){var t=Math.abs(Math.ceil(e.perSlide)),i=e.displayed;return("slide"!==e.animation||t>i)&&(t=i),t},n.prototype.computeIndex=function(e,t){var i=this,n=e+("next"===t?i.settings.perSlide:-i.settings.perSlide);return this.stoppedAtEnd=!1,n>=i.elements.length?i.settings.loop?0:(this.stoppedAtEnd=!0,e):n<=-i.settings.perSlide?i.settings.loop?i.elements.length-1:(this.stoppedAtEnd=!0,e):0>n?0:n},n.prototype.hideNavs=function(){this.shouldHideNext=!1,this.shouldHidePrev=!1,this.settings.loop||(this.shouldHideNext=this.activeIndex>=this.elements.length-this.settings.displayed,this.shouldHidePrev=this.activeIndex<this.settings.perSlide)},n.prototype.move=function(e,n,s,a){var r=this,o=r.activeIndex;switch(r.hasStarted=!0,n&&this.settings.stopAfterAction&&(this.userAction=!0),e){case"next":case"prev":r.activeIndex=r.computeIndex(r.activeIndex,e,a);break;default:r.activeIndex=i(e)}this.setInterval(this.shouldStop()),this.hideNavs(),this.sliderMargin=-r.getMargin(),o!==r.activeIndex&&(!s&&r.settings.beforeSlide&&"function"==typeof r.scope.$parent[r.settings.beforeSlide]&&r.scope.$parent[r.settings.beforeSlide](o,r.activeIndex),!s&&r.settings.afterSlide&&t(function(){"function"==typeof r.scope.$parent[r.settings.afterSlide]&&r.scope.$parent[r.settings.afterSlide](r.activeIndex)},r.settings.transitionDuration))},n.prototype.getStyles=function(){this.updateSizes();var e={};return null!==this.activeIndex&&("slide"===this.settings.animation?e={"margin-left":this.sliderMargin||"0px"}:this.isReady&&(e={height:this.sizes[this.activeIndex].height})),e["transition-duration"]=this.settings.transitionDuration/1e3+"s",e},n.prototype.setInterval=function(t){var i=this;e.cancel(i.interval),i.playing=!1,i.hideNavs(),t||i.settings.sync||0===i.settings.sync||(i.interval=e(function(){i.stoppedAtEnd=!1,i.playing=!0,i.move("next")},i.settings.timeInterval))},n.prototype.shouldStop=function(){return this.settings.autoplay?this.userAction&&this.settings.stopAfterAction||this.pausedByUser||this.stoppedAtEnd?!0:!1:!0},n.prototype.updateSizes=function(){for(var e=0;e<this.elements.length;e++){var t=angular.element(this.elements[e]);this.sizes[e]={width:t.outerWidth(),height:t.outerHeight()}}},n.prototype.update=function(e){var i=this;e&&this.setInterval(this.shouldStop()),this.bindEvents(),this.hasStarted&&t(function(){i.move(i.activeIndex,!1,!0)},100)},n.prototype.getMargin=function(){for(var e=0,t=0;t<this.elements.length;t++)t<this.loopUntil(this.activeIndex)&&t<this.elements.length-this.settings.displayed&&(e+=this.sizes[t].width);return e},n.prototype.loopUntil=function(e){return this.isCentered=!1,this.settings.centerActive&&1&this.settings.displayed&&(e-=Math.floor(this.settings.displayed/2),this.isCentered=!0),e},n.prototype.shift=function(e){this.sliderMargin=-(this.getMargin()+e)},n.prototype.removeSlide=function(e){this.elements.splice(this.elements.indexOf(e),1),this.update()},n.prototype.pause=function(){this.pausedByUser=!0,this.setInterval(!0)},n.prototype.resume=function(){this.stoppedAtEnd||(this.pausedByUser=!1,this.setInterval(this.shouldStop()))},n.prototype.mouseEnterCallback=function(){this.settings.pauseOnHover&&this.pause(),this.settings.navOnHover&&(this.shouldHideNav=!1),this.settings.pagerOnHover&&(this.shouldHidePager=!1)},n.prototype.mouseLeaveCallback=function(){this.wrapperDomElement.trigger("touchend"),!this.settings.stopAfterHover&&this.settings.pauseOnHover&&this.resume(),this.settings.navOnHover&&this.settings.hideNav&&(this.shouldHideNav=!0),this.settings.pagerOnHover&&this.settings.hidePager&&(this.shouldHidePager=!0)},n.prototype.bindEvents=function(e){var t=this,i=this.settings.pauseOnHover||this.settings.pagerOnHover||this.settings.navOnHover;(e||!i)&&(this.wrapperDomElement.unbind(),this.binded=!1),e||!i||this.binded||(this.binded=!0,this.wrapperDomElement.bind({mouseenter:function(){t.mouseEnterCallback()},mouseleave:function(){t.mouseLeaveCallback()}}))},n}]),angular.module("angular-kaarousel").directive("kaarouselSlide",function(){return{restrict:"EA",require:"^kaarousel",link:function(e,t,i,n){var s,a=n.getFactory(),r=e.$index;angular.element(t).addClass("kaarousel-slide"),i.ngRepeat&&(s=i.ngRepeat.split(" ")[0]),n.addSlide(t,s?e[s]:null),e.$last&&n.reachedLastItem(),e.isActive=function(){return a.get("activeIndex")===r},e.itemStyles=function(){var t=n.getSettings(),i=r%t.displayed,s=100/t.displayed,a={width:s+"%"};return"shuffle"===t.animation&&(a.left=Math.abs(i)*s+(e.isVisible()?0:100)+"%"),"fade"===t.animation&&(a.left=i*s+"%"),a},e.isVisible=function(){var e=a.get("activeIndex"),t=a.get("elements").length,i=n.getSettings().displayed;return n.getSettings().centerActive&&a.get("isCentered")?r>=e-Math.floor(i/2)&&r<=e+Math.floor(i/2)||i>e+1&&i>r||e>t-i-1&&r>t-i-1:r>=e&&e+i>r||r>t-i-1&&e>t-i-1},e.$on("$destroy",function(){a.removeSlide(t)})}}}),angular.module("angular-kaarousel").directive("kaarouselNav",function(){return{require:"^kaarousel",restrict:"EA",link:function(e,t,i,n){var s=n.getFactory();e.shouldHideNav=function(){return s.get("shouldHideNav")||s.get("elements").length<=n.getSettings().displayed},e.shouldHideNext=function(){return s.get("shouldHideNext")},e.shouldHidePrev=function(){return s.get("shouldHidePrev")}}}}).directive("kaarouselPager",function(){return{restrict:"EA",require:"^kaarousel",link:function(e,t,i,n){var s=n.getFactory();e.shouldHidePager=function(){return s.get("shouldHidePager")}}}}),angular.module("angular-kaarousel").directive("kaarouselWrapper",["$swipe","$timeout",function(e,t){return{restrict:"EA",require:"^kaarousel",link:function(i,n,s,a){var r,o,l=120,u=200,d=a.getFactory(),c=function(){var e=a.getSettings();return e.isSwipable&&a.getFactory().elements.length>e.displayed},p=function(){return r&&o&&Math.abs(r.x-o.x)>l},g=function(){return Math.floor(Math.abs(r.x-o.x)/u)+1};a.register("wrapperDomElement",n),d.bindEvents(),i.addSwipeOffset=function(){var e=r.x-o.x;d.shift(e)},i.resetSwipe=function(){i.shouldAnim=!0,i.dragging=!1,d.move(d.get("activeIndex"),!0,!0)},i.swipeHandler=e.bind(n,{start:function(e){c()&&t(function(){r=e,o=null})},move:function(e){c()&&t(function(){o=e,i.shouldAnim=!1,i.dragging=!0,i.addSwipeOffset()})},end:function(){c()&&o&&t(function(){var e=r.x-o.x;p()?e>0?d.get("activeIndex")<d.get("elements").length-1?d.move("next",!0,!1,g()):i.resetSwipe():d.get("activeIndex")>0?d.move("prev",!0,!1,g()):i.resetSwipe():i.resetSwipe(),i.shouldAnim=!0,i.dragging=!1})},cancel:function(){c()&&t(function(){i.resetSwipe()})}})}}}]).directive("kaarouselSlider",["$compile",function(e){return{restrict:"EA",require:"^kaarousel",link:function(t,i,n,s){var a='<kaarousel-dummy class="dummy" ng-style="getStyles()"></kaarousel-dummy>',r=angular.element(i);s.register("sliderDomElement",i),r.addClass(s.getSettings().animation+"-animation"),t.getStyles=function(){return s.getFactory().getStyles()},e(a)(t,function(e){r.prepend(e)})}}}]),function(e){try{e=angular.module("angular-kaarousel")}catch(t){e=angular.module("angular-kaarousel",[])}e.run(["$templateCache",function(e){e.put("src/angular-kaarousel.html",'<kaarousel-container class="kaarousel-actions-wrapper"><kaarousel-wrapper class="kaarousel-wrapper" ng-class="{anim: shouldAnim, dragging: dragging}"><kaarousel-slider ng-transclude="" class="kaarousel-slider"></kaarousel-slider></kaarousel-wrapper><kaarousel-nav class="kaarousel-nav" ng-class="{\'is-hidden\': shouldHideNav()}"><kaarousel-prev ng-click="move(\'prev\')" ng-class="{\'is-hidden\': shouldHidePrev()}" class="kaarousel-prev">PREV</kaarousel-prev><kaarousel-next ng-click="move(\'next\')" ng-class="{\'is-hidden\': shouldHideNext()}" class="kaarousel-next">NEXT</kaarousel-next></kaarousel-nav><kaarousel-pager class="kaarousel-pager" ng-class="{\'is-hidden\': shouldHidePager()}"><ul><li ng-repeat="i in factory.elements track by $index" ng-click="move($index)" ng-class="{selected: $index === factory.activeIndex}">{{$index}}</li></ul></kaarousel-pager></kaarousel-container>')}])}();